<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
  ~ Copyright 2023 JaYu.space
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<!-- Issue Req Mapper -->
<mapper namespace="com.vertexid.support.issue.IssueReq.mysql">
    <insert id="insertReq" parameterType="com.vertexid.support.issue.IssueReqDTO">
        INSERT INTO t_issue_req(
            ISSUE_ID
            , ORG_ID
            , SYSTEM_ID
            , REQ_NO
            , ISSUE_STU_CD
            , REQ_ID
            , REQ_REAL_ID
            , REQ_NM
            , REQ_EMAIL
            , REQ_DTE
            , REQ_ISSUE_TP_CD
            , REQ_ISSUE_DOMAIN_CD
            , REQ_END_DTE
            , REQ_ISSUE_TITLE
            , REQ_ISSUE_CONTS
            , USE_YN
            , REG_DTE
            , REG_LOGIN_ID
            , UPT_DTE
            , UPT_LOGIN_ID
        )VALUES(
             #{issueId}
            , (SELECT org_id FROM T_SUPPORT_SYS_INFO WHERE SYSTEM_ID = #{systemId})
            , #{systemId}
            , F_SYS_ISSUE_NO()
            , #{issueStuCd}
            , #{loginInfo.loginId}
            , ''
            , #{loginInfo.nmKo}
            , #{loginInfo.email}
            , NOW()
            , #{reqIssueTpCd}
            , #{reqIssueDomainCd}
            , STR_TO_DATE(#{reqEndDte}, '%Y-%m-%d')
            , #{reqIssueTitle}
            , #{reqIssueConts}
            , 'Y'
            , NOW()
            , #{loginInfo.loginId}
            , NOW()
            , #{loginInfo.loginId}
        )
    </insert>


    <update id="updateReq" parameterType="com.vertexid.support.issue.IssueReqDTO">
        UPDATE t_issue_req
        <set>
            , UPT_DTE = NOW()
            , UPT_LOGIN_ID = #{loginInfo.loginId}
            , REQ_DTE = NOW()
            , REQ_ISSUE_TP_CD = #{reqIssueTpCd}
            , REQ_ISSUE_DOMAIN_CD = #{reqIssueDomainCd}
            , REQ_END_DTE = STR_TO_DATE(#{reqEndDte}, '%Y-%m-%d')
            , REQ_ISSUE_TITLE = #{reqIssueTitle}
            , REQ_ISSUE_CONTS = #{reqIssueConts}
        </set>
        <where>
            AND ISSUE_ID = #{issueId}
        </where>
    </update>

    <update id="insertRcv" parameterType="com.vertexid.support.issue.IssueReqDTO">
        UPDATE t_issue_req
        <set>
            , UPT_DTE = NOW()
            , UPT_LOGIN_ID = #{loginInfo.loginId}
            , ISSUE_STU_CD = #{issueStuCd}
            , RCV_ID = #{loginInfo.loginId}
            , RCV_DTE = NOW()
            , RCV_ISSUE_TP_CD = #{rcvIssueTpCd}
            , RCV_ISSUE_DOMAIN_CD = #{rcvIssueDomainCd}
            , RCV_EXP_MANDAY = #{rcvExpManday}
            , SCHEDUL_END_DTE = STR_TO_DATE(#{schedulEndDte}, '%Y-%m-%d')
            , RCV_COMMENT = #{rcvComment}
        </set>
        <where>
            AND ISSUE_ID = #{issueId}
        </where>
    </update>

    <update id="updateStu" parameterType="com.vertexid.support.issue.IssueReqDTO">
        UPDATE t_issue_req
        <set>
            , UPT_DTE = NOW()
            , UPT_LOGIN_ID = #{loginInfo.loginId}
            , ISSUE_STU_CD = #{issueStuCd}
        </set>
        <where>
            AND ISSUE_ID = #{issueId}
        </where>
    </update>

    <update id="deleteIssue" parameterType="com.vertexid.support.issue.IssueReqDTO">
        UPDATE t_issue_req
        <set>
            , UPT_DTE = NOW()
            , UPT_LOGIN_ID = #{loginInfo.loginId}
            , USE_YN = 'N'
        </set>
        <where>
            AND ISSUE_ID = #{issueId}
        </where>
    </update>

</mapper>